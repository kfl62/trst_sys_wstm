:ruby
  firm     = Wstm::PartnerFirm.find_by(firm: true)
  client   = Wstm::PartnerFirm.find(params[:client_id])
  client_d = client.people.find(params[:client_d_id]) rescue nil
  dln_ary  = params[:dln_ary].split(',')
  dln_ary.each{|id| @object.dlns << Wstm::DeliveryNote.find(id)}
%span#hidden_data.hidden{data: {dialog: 'create',model_name: mat(@object,'model_name'),oid: 'null',js_ext: 'desk_invoice'}}
%form{action: "/sys/#{@path}", method: 'post'}
  %table{cellspacing: "0"}
    %thead
      %tr
        %td
          - label_for @object, 'name'
          - input_for @object, 'name',        {value: @object.increment_name,style: 'ui-state-default ce id_intern'}
          - label_for @object, 'id_date'
          - input_for @object, 'id_date',     {id: 'date_show',name: 'strip'}
          - input_for @object, 'id_date',     {id: 'date_send',type: 'hidden',value: @object.id_date.to_s}
          - input_for @object, 'id_intern',   {type: 'hidden',value: 'false'}
          - input_for @object, 'client_id',   {type: 'hidden',value: client.id}
          - input_for @object, 'client_d_id', {type: 'hidden',value: client_d.id}
          - input_for @object, 'signed_by',   {type: 'hidden',value: @current_user.id}
          - dln_ary.each do |dn|
            -input_for @object,'dln_ids',     {type: 'hidden',name: "[#{@path}][dln_ids][]",value: dn}
      %tr
        %td
          - input_for  @object,'doc_name',    {placeholder: mat(@object,'doc_name'), style: 'ui-state-default focus'}
      %tr
        %td
          %span.info.width-450.ju= t('intro.create.desk_invoice')
      %tr
        %td
          %hr
          %span.small{style: 'max-width: 500px'}= mat(@object,'dlns_name').concat @object.dlns.map(&:doc_name).join(', ')
      = partial "#{@path}/form", locals: {dlns: dln_ary}
      %tfoot
        %tr
          %td.buttonset.ce
            %button{type: "button", data: {action: "save",  icon: "disk",remove: 'false'}}= t('button.save')
            %button{type: "button", data: {action: "cancel",icon: "circle-close"}}= t('button.cancel')
