:ruby
  unit_id = @current_user.unit_id.nil? ? session[:unit_id] : @current_user.unit_id
%span#hidden_data.hidden{data: {dialog: "repair",model_name: mat(@object,'model_name'),oid: "null",js_ext: 'desk_grn'}}
-if unit_id
  - unless @current_user.unit_id
    = partial 'wstm/shared/select_unit'
  %form{action: "/sys/#{@path}", method: "get"}
    %table{cellspacing: "0"}
      %thead
        - if @current_user.unit_id
          %tr
            %td{colspan: "4"}
              %span.info.width-400.ju= t('intro.repair.desk_grn')
              %input#date_send{type: 'hidden', value: Date.today.to_s}
        - else
          %tr
            %td{colspan: "4"}
              %span= mat(@object,'day')
              %input#date_show.ui-state-default{type: 'text',value: l(Date.today,format: :trst)}
              %input#date_send{type: 'hidden', value: Date.today.to_s}
      %tbody
        %tr
          %td
            %input.repair{type: 'hidden',style: 'width:400px',data: {search: 'Wstm::Grn',ph: 4,uid: unit_id}}
      %tfoot
        %tr
          %td.buttonset.ce{colspan: "6"}
            %button{type: "button", data: {action: "cancel", icon: "circle-close"}}= t('button.cancel')
-else
  %form{action: "/sys/#{@path}", method: "get"}
    = partial 'wstm/shared/select_unit'
